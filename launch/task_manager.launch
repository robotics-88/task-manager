<launch>
    <arg name="mavros_map_frame" default="map"/>
    <arg name="base_frame" default="base_link"/>
    <arg name="slam_map_frame" default="slam_map"/>
    <arg name="slam_pose_topic" default="/decco/pose"/>
    <arg name="goal_topic" default="/mavros/setpoint_position/local"/> <!-- for mavros without OA, use /mavros/setpoint_position/local. default is /goal.-->

    <!-- Which hardware to add to health report -->
    <arg name="do_mapir" default="true"/>
    <arg name="do_mapir_rgb" default="false"/>
    <arg name="do_attollo" default="true"/>
    <arg name="do_thermal_cam" default="false"/>
    <arg name="thermal_type" default="0"/>
    <arg name="lidar_type" default="4"/> <!-- 2 = Velodyne, 4 = Mid360-->

    <arg name="enable_autonomy" default="false"/>
    <arg name="enable_exploration" default="false"/>
    <arg name="ardupilot" default="true"/>
    
    <arg name="default_altitude_m" default="2.0"/>
    <arg name="min_altitude" default="2.0"/>
    <arg name="max_altitude" default="10.0"/>
    <arg name="max_dist_to_polygon" default="500"/>
    <arg name="flightleg_area_acres" default="3"/> <!-- 1 acre = 4046 m2-->

    <!-- Health topics -->
    <arg name="path_planner_topic" default="/kd_pointcloud_accumulated"/>
    <arg name="costmap_topic" default="/costmap_node/costmap/costmap_updates"/>
    <arg name="lidar_topic" default="/livox/lidar"/>
    <arg name="attollo_topic" default="/attollo_cam/image_rect"/>
    <arg name="mapir_topic" default="/mapir_rgn/image_rect_color"/>
    <arg name="mapir_rgb_topic" default="/mapir_rgb/image_rect_color"/>
    <arg name="rosbag_topic" default="/record/heartbeat"/>

    <arg name="thermal_topic" default="/thermal_cam/image_rect_color" if="$(eval thermal_type == 0)"/>
    <arg name="thermal_topic" default="/seek_thermal/image_rect_color" if="$(eval thermal_type == 1)"/>

     <!-- Record -->
    <arg name="do_slam" default="true"/>
    <arg name="do_record" default="true"/>
    <arg name="user" value="$(env USER)"/>
    <arg name="data_directory" default="/home/$(arg user)/src/bags/"/>

    <arg name="simulate" default="false"/>
    <arg name="offline" default="false"/>

    <!-- Params for the case when UTM and map yaw need to be set manually from prior bag -->
    <arg name="explicit_global" default="false"/>
    <arg name="map_yaw" default="-1.49837"/>
    <arg name="utm_y" default="3354710"/>
    <arg name="utm_x" default="243885"/>
    <arg name="utm_zone" default="15"/>
    
    <node pkg="task_manager_88" type="task_manager" name="task_manager" output="screen">
        <param name="do_slam" value="$(arg do_slam)"/>
        <param name="enable_autonomy" value="$(arg enable_autonomy)"/>
        <param name="enable_exploration" value="$(arg enable_exploration)"/>
        <param name="goal_topic" value="$(arg goal_topic)"/>
        <param name="do_record" value="$(arg do_record)"/>
        <param name="data_directory" value="$(arg data_directory)"/>
        <param name="mavros_map_frame" value="$(arg mavros_map_frame)"/>
        <param name="base_frame" value="$(arg base_frame)"/>
        <param name="slam_map_frame" value="$(arg slam_map_frame)"/>
        <param name="path_planner_topic" value="$(arg path_planner_topic)"/>
        <param name="slam_pose_topic" value="$(arg slam_pose_topic)"/>
        <param name="costmap_topic" value="$(arg costmap_topic)"/>
        <param name="lidar_topic" value="$(arg lidar_topic)"/>
        <param name="mapir_topic" value="$(arg mapir_topic)"/>
        <param name="mapir_rgb_topic" value="$(arg mapir_rgb_topic)"/>
        <param name="attollo_topic" value="$(arg attollo_topic)"/>
        <param name="thermal_topic" value="$(arg thermal_topic)"/>
        <param name="rosbag_topic" value="$(arg rosbag_topic)"/>
        <param name="default_altitude_m" value="$(arg default_altitude_m)"/>
        <param name="min_altitude" value="$(arg min_altitude)"/>
        <param name="max_altitude" value="$(arg max_altitude)"/>
        <param name="max_dist_to_polygon" value="$(arg max_dist_to_polygon)"/>
        <param name="ardupilot" value="$(arg ardupilot)"/>
        <param name="flightleg_area_acres" value="$(arg flightleg_area_acres)"/>
        <param name="all_stream_rate" value="5"/>
        <param name="imu_rate" value="120"/>
        <param name="local_pos_rate" value="60"/>
        <param name="simulate" value="$(arg simulate)"/>
        <param name="offline" value="$(arg offline)"/>
        <param name="explicit_global" value="$(arg explicit_global)"/>
        <param name="map_yaw" value="$(arg map_yaw)"/>
        <param name="utm_y" value="$(arg utm_y)"/>
        <param name="utm_x" value="$(arg utm_x)"/>
        <param name="utm_zone" value="$(arg utm_zone)"/>
        <param name="battery_size" value="5.2"/> <!-- Battery size in amp hours -->
        <param name="estimated_current" value="20"/> <!-- Starting estimate for current consumption -->
        <param name="estimated_drone_speed" value="2.0"/> <!-- m/s -->
        <param name="battery_failsafe_safety_factor" value="2.0"/>
        <param name="do_mapir" value="$(arg do_mapir)"/>
        <param name="do_mapir_rgb" value="$(arg do_mapir_rgb)"/>
        <param name="do_attollo" value="$(arg do_attollo)"/>
        <param name="do_thermal_cam" value="$(arg do_thermal_cam)"/>
        <param name="lidar_type" value="$(arg lidar_type)"/>
    </node>
</launch>